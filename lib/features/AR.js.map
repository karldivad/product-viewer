{"version":3,"file":"AR.js","sourceRoot":"","sources":["../../src/features/AR.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2022 Lowe's Companies, Inc. All Rights Reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport ProductViewerElementBase from \"../product-viewer-base\";\nimport { Constructor, safeStringValue, isIOS, isAndroid } from \"../tools/Utils\";\nimport { property } from \"lit/decorators.js\";\n\nexport declare interface ARInterface {\n\tmodelUrl: string;\n\tar: boolean;\n\tarScaling: boolean;\n\tusdz: string | null;\n}\n\nexport const ARMixin = <T extends Constructor<ProductViewerElementBase>>(\n\tBaseViewerElement: T,\n): Constructor<ARInterface> & T => {\n\tclass ARModelViewerElement extends BaseViewerElement {\n\t\t@property({ type: String, attribute: \"model-url\" }) modelUrl: string;\n\t\t@property({ type: Boolean, attribute: \"ar\" }) ar = false;\n\t\t@property({ type: Boolean, attribute: \"ar-scaling\" }) arScaling = false;\n\t\t@property({ type: String, attribute: \"usdz\" }) usdz: string | null = null;\n\n\t\tARButtonElement: HTMLElement = this.shadowRoot?.querySelector(\".ar-button\");\n\t\tARButtonClickEvent = (event: Event) => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.launchAR();\n\t\t};\n\n\t\tupdated(changedProperties: Map<string, any>): void {\n\t\t\tsuper.updated?.(changedProperties);\n\t\t\tthis.ARButtonElement = this.shadowRoot?.querySelector(\".ar-button\");\n\t\t\tthis.ARButtonElement.onclick = this.ARButtonClickEvent;\n\n\t\t\tif (!this.ar || (!isAndroid() && !isIOS()) || (isIOS() && !this.supportsIOSQuickLook())) {\n\t\t\t\tthis.ARButtonElement.classList.remove(\"enabled\");\n\t\t\t}\n\t\t}\n\n\t\tlaunchAR() {\n\t\t\tif (isIOS()) {\n\t\t\t\tthis.openIOSARQuickLook();\n\t\t\t} else {\n\t\t\t\tthis.openSceneViewer();\n\t\t\t}\n\t\t}\n\n\t\topenIOSARQuickLook() {\n\t\t\tconst anchor = document.createElement(\"a\");\n\t\t\tanchor.setAttribute(\"rel\", \"ar\");\n\t\t\tanchor.appendChild(document.createElement(\"img\"));\n\n\t\t\tconst usdzUrl = this.usdz + \"#allowsContentScaling=0\";\n\t\t\tanchor.setAttribute(\"href\", usdzUrl);\n\t\t\tanchor.click();\n\t\t}\n\n\t\topenSceneViewer(customIntent = \"\") {\n\t\t\tconst anchor = document.createElement(\"a\");\n\t\t\tconst noArViewerSigil = \"#model-viewer-no-ar-fallback\";\n\t\t\tlet fallbackInvoked = false;\n\n\t\t\tif (fallbackInvoked) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst defaultIntent = this.createAndroidIntent();\n\n\t\t\tconst testModelUrl = new URL(\n\t\t\t\t\"https://AssetManager.azureedge.net/assets-v2/ed3d4508-dd22-4683-985b-1502694cde0c%5C132031998958633125.glb?7713ff81ffd1d4677ade591e212c38c29edd8a76f694360bd5f31ef82744b310cdb72cef2ff0677de17e7c87c56859b90203b4\",\n\t\t\t);\n\t\t\ttestModelUrl.protocol = \"intent://\";\n\n\t\t\tconst intent = safeStringValue(customIntent, defaultIntent);\n\n\t\t\tconst handleFallback = () => {\n\t\t\t\tif (self.location.hash === noArViewerSigil && !fallbackInvoked) {\n\t\t\t\t\tfallbackInvoked = true;\n\t\t\t\t\t// The new history will be the current URL with a new hash.\n\t\t\t\t\t// Go back one step so that we reset to the expected URL.\n\t\t\t\t\t// NOTE(cdata): this should not invoke any browser-level navigation\n\t\t\t\t\t// because hash-only changes modify the URL in-place without\n\t\t\t\t\t// navigating:\n\t\t\t\t\tself.history.back();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tself.addEventListener(\"hashchange\", handleFallback, { once: true });\n\n\t\t\tanchor.setAttribute(\"href\", intent);\n\t\t\tanchor.click();\n\t\t}\n\n\t\tcreateAndroidIntent() {\n\t\t\t// This is necessary because the original URL might have query\n\t\t\t// parameters. Since we're appending the whole URL as query parameter,\n\t\t\t// ? needs to be turned into & to not lose any of them.\n\t\t\tconst gltfSrc = this.modelUrl.replace(\"?\", \"&\");\n\t\t\tconst location = self.location.toString();\n\t\t\tconst locationUrl = new URL(location);\n\t\t\tconst cleanUrl = new URL(gltfSrc, location);\n\n\t\t\t// modelUrl can contain title/link/sound etc.\n\t\t\t// These are already URL-encoded, so we shouldn't do that again here.\n\t\t\tlet intentParams = `?file=${cleanUrl.toString()}&mode=ar_only`;\n\n\t\t\tif (!gltfSrc.includes(\"&link=\")) {\n\t\t\t\tintentParams += `&link=${location}`;\n\t\t\t}\n\t\t\t// if (!gltfSrc.includes(\"&title=\")) {\n\t\t\t// \tintentParams += `&title=${encodeURIComponent(this.alt || \"\")}`;\n\t\t\t// }\n\t\t\tintentParams += `&resizable=false`;\n\n\t\t\tconst intent = `intent://arvr.google.com/scene-viewer/1.0${intentParams}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(\n\t\t\t\tlocationUrl.toString(),\n\t\t\t)};end;`;\n\n\t\t\treturn intent;\n\t\t}\n\n\t\tsupportsIOSQuickLook() {\n\t\t\tconst tempAnchor = document.createElement(\"a\");\n\n\t\t\treturn Boolean(\n\t\t\t\ttempAnchor.relList && tempAnchor.relList.supports && tempAnchor.relList.supports(\"ar\") && this.usdz,\n\t\t\t);\n\t\t}\n\t}\n\treturn ARModelViewerElement as Constructor<ARInterface> & T;\n};\n"]}